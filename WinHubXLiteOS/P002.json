{
  "Description": "Rimozione servizi e bloatware per Windows 11",
  "Order": "P002",
  "PSArray": [
    {
      "Nome": "Disattivazioni Servizi",
      "Command23h2": [
    "$services = @(", 
    "    'diagnosticshub.standardcollector.service'",
    "    'DiagTrack'",                                  
    "    'dmwappushservice'",                           
    "    'lfsvc'",                                      
    "    'MapsBroker'",                                 
    "    'NetTcpPortSharing'",                          
    "    'RemoteAccess'",                               
    "    'RemoteRegistry'",                             
    "    'SharedAccess'",                               
    "    'TrkWks'",                                     
    "    'WbioSrvc'",                                   
    "    'WMPNetworkSvc'",                              
    "    'XblAuthManager'",                             
    "    'XblGameSave'",                                
    "    'XboxNetApiSvc'",                              
    "    'ndu'",                                        
    ")", 
    "", 
    "foreach ($service in $services) {", 
    "    Get-Service -Name $service | Set-Service -StartupType Disabled", 
    "}"
   ],
   "Command24h2": [
    "$services = @(", 
    "    'DiagTrack'",                                  
    "    'dmwappushservice'",                           
    "    'lfsvc'",                                      
    "    'MapsBroker'",                                 
    "    'NetTcpPortSharing'",                          
    "    'RemoteAccess'",                               
    "    'RemoteRegistry'",                             
    "    'SharedAccess'",                               
    "    'TrkWks'",                                     
    "    'WbioSrvc'",                                   
    "    'WMPNetworkSvc'",                              
    "    'XblAuthManager'",                             
    "    'XblGameSave'",                                
    "    'XboxNetApiSvc'",                              
    "    'ndu'",                                        
    ")", 
    "", 
    "foreach ($service in $services) {", 
    "    Get-Service -Name $service | Set-Service -StartupType Disabled", 
    "}"
   ]
    },
    {
     "Nome": "Disattivazione Servizi",
     "Command": [
    "$Services = @(", 
    "    'MixedRealityOpenXRSvc'", 
    "    'WMPNetworkSvc'", 
    "    'WerSvc'", 
    "    'WalletService'", 
    "    'SysMain'", 
    "    'SCPolicySvc'", 
    "    'ScDeviceEnum'", 
    "    'SCardSvr'", 
    "    'RetailDemo'", 
    "    'WpcMonSvc'", 
    "    '*diagnosticshub*'", 
    "    'MapsBroker'", 
    "    'TrkWks'", 
    "    'WdiSystemHost'", 
    "    'WdiServiceHost'", 
    "    'DPS'", 
    "    'diagsvc'", 
    ")", 
    "", 
    "foreach ($Service in $Services) {", 
    "    Get-Service -Name $Service -ErrorAction SilentlyContinue | Set-Service -StartupType Disabled", 
    "    if ((Get-Service -Name $Service -ErrorAction SilentlyContinue).Status -eq 'Running') {", 
    "        Stop-Service -Name $Service -Force -ErrorAction SilentlyContinue | Out-Null", 
    "    }", 
    "}"
]
    },
    {
      "Nome": "Disattivazione Telemetria",
      "Command": [
        "Disable-ScheduledTask -TaskName 'Microsoft\\Windows\\Application Experience\\Microsoft Compatibility Appraiser'",
        "Disable-ScheduledTask -TaskName 'Microsoft\\Windows\\Application Experience\\ProgramDataUpdater'",
        "Disable-ScheduledTask -TaskName 'Microsoft\\Windows\\Autochk\\Proxy'",
        "Disable-ScheduledTask -TaskName 'Microsoft\\Windows\\Customer Experience Improvement Program\\Consolidator'",
        "Disable-ScheduledTask -TaskName 'Microsoft\\Windows\\Customer Experience Improvement Program\\UsbCeip'",
        "Disable-ScheduledTask -TaskName 'Microsoft\\Windows\\DiskDiagnostic\\Microsoft-Windows-DiskDiagnosticDataCollector'"
      ]
    },
    {
      "Nome": "Disattiva accesso in background delle app predefinite",
      "Command": [
        "$basePath = 'HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\BackgroundAccessApplications'",
        "if (Test-Path $basePath) {",
        "    foreach ($key in Get-ChildItem $basePath) {",
        "        Set-ItemProperty -Path \"$basePath\\$($key.PSChildName)\" -Name \"Disabled\" -Value 1 -ErrorAction SilentlyContinue",
        "    }",
        "}"
      ]
    },    
    {
      "Nome": "Disattiva reporting di Windows Error",
      "Command": [
        "Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting' -Name \"Disabled\" -Type DWord -Value 1",
        "Disable-ScheduledTask -TaskName 'Microsoft\\Windows\\Windows Error Reporting\\QueueReporting'"
      ]
    },
    {
      "Nome": "Disattivazioni Gruppi",
      "Command": [
        "$groups = @(", 
        "    'Accessibility'", 
        "    'AppSync'", 
        "    'BrowserSettings'", 
        "    'DesktopTheme'", 
        "    'Language'", 
        "    'PackageState'", 
        "    'Personalization'", 
        "    'StartLayout'", 
        "    'Windows'", 
        ")", 
        "",
        "foreach ($group in $groups) {", 
        "    $regPath = 'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\State\\Machine\\$group'",
        "    if (Test-Path $regPath) {",
        "        Remove-Item -Path $regPath -Recurse -Force -ErrorAction SilentlyContinue",
        "    }",
        "}"
      ]
    },     
    {
     "Nome": "Disattivazioni Task",
     "Command": [
    "[Array] @(", 
    "    '\\Microsoft\\Windows\\ApplicationData\\CleanupTemporaryState'", 
    "    '\\Microsoft\\Windows\\ApplicationData\\DsSvcCleanup'", 
    "    '\\Microsoft\\Windows\\AppxDeploymentClient\\Pre-stagedappcleanup'", 
    "    '\\Microsoft\\Windows\\Autochk\\Proxy'", 
    "    '\\Microsoft\\Windows\\BrokerInfrastructure\\BgTaskRegistrationMaintenanceTask'", 
    "    '\\Microsoft\\Windows\\capabilityaccessmanager\\maintenancetasks'", 
    "    '\\Microsoft\\Windows\\Chkdsk\\ProactiveScan'", 
    "    '\\Microsoft\\Windows\\Chkdsk\\SyspartRepair'", 
    "    '\\Microsoft\\Windows\\Clip\\LicenseValidation'", 
    "    '\\Microsoft\\Windows\\CloudExperienceHost\\CreateObjectTask'", 
    "    '\\Microsoft\\Windows\\CustomerExperienceImprovementProgram\\Consolidator'", 
    "    '\\Microsoft\\Windows\\CustomerExperienceImprovementProgram\\UsbCeip'", 
    "    '\\Microsoft\\Windows\\Defrag\\ScheduledDefrag'", 
    "    '\\Microsoft\\Windows\\DeviceInformation\\Device'", 
    "    '\\Microsoft\\Windows\\DeviceInformation\\DeviceUser'", 
    "    '\\Microsoft\\Windows\\DeviceSetup\\MetadataRefresh'", 
    "    '\\Microsoft\\Windows\\ExploitGuard\\ExploitGuardMDMpolicyRefresh'", 
    "    '\\Microsoft\\Windows\\Feedback\\Siuf\\DmClient'", 
    "    '\\Microsoft\\Windows\\Feedback\\Siuf\\DmClientOnScenarioDownload'", 
    "    '\\Microsoft\\Windows\\FileHistory\\FileHistory*'", 
    "    '\\Microsoft\\Windows\\Location\\Notifications'", 
    "    '\\Microsoft\\Windows\\Location\\WindowsActionDialog'", 
    "    '\\Microsoft\\Windows\\Maps\\MapsToastTask'", 
    "    '\\Microsoft\\Windows\\Maps\\MapsUpdateTask'", 
    "    '\\Microsoft\\Windows\\MemoryDiagnostic\\ProcessMemoryDiagnosticEvents'", 
    "    '\\Microsoft\\Windows\\MemoryDiagnostic\\RunFullMemoryDiagnostic'", 
    "    '\\Microsoft\\Windows\\MUI\\LPRemove'", 
    "    '\\Microsoft\\Windows\\Multimedia\\SystemSoundsService'", 
    "    '\\Microsoft\\Windows\\OfflineFiles\\BackgroundSynchronization'", 
    "    '\\Microsoft\\Windows\\OfflineFiles\\LogonSynchronization'", 
    "    '\\Microsoft\\Windows\\Printing\\EduPrintProv'", 
    "    '\\Microsoft\\Windows\\Printing\\PrinterCleanupTask'", 
    "    '\\Microsoft\\Windows\\PushToInstall\\LoginCheck'", 
    "    '\\Microsoft\\Windows\\PushToInstall\\Registration'", 
    "    '\\Microsoft\\Windows\\RetailDemo\\CleanupOfflineContent'", 
    "    '\\Microsoft\\Windows\\Servicing\\StartComponentCleanup'", 
    "    '\\Microsoft\\Windows\\Setup\\SetupCleanupTask'", 
    "    '\\Microsoft\\Windows\\SharedPC\\AccountCleanup'", 
    "    '\\Microsoft\\Windows\\UNP\\RunUpdateNotificationMgr'", 
    "    '\\Microsoft\\Windows\\WindowsErrorReporting\\QueueReporting'", 
    "    '\\Microsoft\\XblGameSave\\XblGameSaveTask'", 
    ") | ForEach-Object {", 
    "    Disable-ScheduledTask -TaskName $_ -ErrorAction SilentlyContinue | Out-Null", 
    "}"
]
    },
    {
     "Nome": "Disattivazioni Task",
     "Command": [
    "$tasks = @(",
    "    '\\Microsoft\\Windows\\Application Experience\\Microsoft Compatibility Appraiser'",
    "    '\\Microsoft\\Windows\\Application Experience\\ProgramDataUpdater'",
    "    '\\Microsoft\\Windows\\Application Experience\\StartupAppTask'",
    "    '\\Microsoft\\Windows\\Application Experience\\PcaPatchDbTask'",
    ")",
    "",
    "foreach ($task in $tasks) {",
    "    Disable-ScheduledTask -TaskName $task -ErrorAction SilentlyContinue",
    "}"
]
    },
    {
      "Nome": "Disattivo sincronizzazione",
      "microsoft": "true",
      "Command": [
        "Set-ItemProperty -Path 'HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\SettingSync' 'BackupPolicy' 0x3c",
        "Set-ItemProperty -Path 'HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\SettingSync' 'DeviceMetadataUploaded' 0",
        "Set-ItemProperty -Path 'HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\SettingSync' 'PriorLogons' 1"
      ]
    },
    {
      "Nome": "Blocca IP Telemetria",
      "Command": [
        "$ips = @(",
        "    '134.170.30.202'",
        "    '137.116.81.24'",
        "    '157.56.106.189'",
        "    '184.86.53.99'",
        "    '2.22.61.43'",
        "    '2.22.61.66'",
        "    '204.79.197.200'",
        "    '23.218.212.69'",
        "    '65.39.117.230'",
        "    '65.55.108.23'",
        "    '64.4.54.254'",
        ")",
        "Remove-NetFirewallRule -DisplayName 'Block Telemetry IPs' -ErrorAction SilentlyContinue",
        "New-NetFirewallRule -DisplayName 'Block Telemetry IPs' -Direction Outbound -Action Block -RemoteAddress ([string[]]$ips) -ErrorAction SilentlyContinue"
      ]
    },
    {
      "Nome": "Disabilita OneDrive",
      "Command": [
        "Stop-Process -Name *onedrive* -ErrorAction SilentlyContinue -Force",
        "Start-Sleep -Seconds 2",
        "$onedrive = \"$env:SYSTEMROOT\\SysWOW64\\OneDriveSetup.exe\"",
        "If (!(Test-Path $onedrive)) { $onedrive = \"$env:SYSTEMROOT\\System32\\OneDriveSetup.exe\" }",
        "Start-Process $onedrive \"/uninstall\" -NoNewWindow -Wait",
        "Start-Sleep -Seconds 2",
        "Stop-Process -Name explorer -Force",
        "Start-Sleep -Seconds 2",
        "Start-Process explorer.exe",
        "Start-Sleep -Seconds 2",
        "If (!(Test-Path \"HKCR:\")) { New-PSDrive -Name HKCR -PSProvider Registry -Root HKEY_CLASSES_ROOT }",
        "Remove-Item -Path \"HKCR:\\CLSID\\{018D5C66-4533-4307-9B53-224DE2ED1FE6}\" -Recurse -ErrorAction SilentlyContinue",
        "Remove-Item -Path \"HKCR:\\Wow6432Node\\CLSID\\{018D5C66-4533-4307-9B53-224DE2ED1FE6}\" -Recurse -ErrorAction SilentlyContinue"
      ]
    }
    
  ]
}

